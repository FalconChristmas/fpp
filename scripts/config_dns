#!/bin/bash
#############################################################################

BINDIR=$(cd $(dirname $0) && pwd)
. ${BINDIR}/common

logOutput

if [ -f "/usr/bin/connmanctl" ]; then
    echo "Using Connection Manager, DNS setup with interfaces"
    exit 0
fi

if [ -f "${CFGDIR}/dns" ]
then
	. ${CFGDIR}/dns

	if [ "x${DNS1}" != "x" -o "x${DNS2}" != "x" ]
	then
		cp -f /etc/resolv.conf /etc/resolv.conf.orig
		echo "# Generated by fpp" > /etc/resolv.conf
		cat /etc/resolv.conf.orig | grep -v ^# | grep -v nameserver >> /etc/resolv.conf

		if [ "x${DNS1}" != "x" ]
		then
			echo "Configuring ${DNS1} as nameserver"
			echo "nameserver ${DNS1}" >> /etc/resolv.conf
		fi

		if [ "x${DNS2}" != "x" ]
		then
			echo "Configuring ${DNS2} as nameserver"
			echo "nameserver ${DNS2}" >> /etc/resolv.conf
		fi
	else
		ifdown wlan0
		ifup wlan0
	fi
fi

